# Sistema de Gerenciamento de Usu√°rios e Grupos - API SOAP

## üöÄ Tecnologias Utilizadas

### Linguagem Principal
- Python 3.x

### Bibliotecas Principais
- **Flask**: Framework web leve e flex√≠vel
- **Spyne**: Framework para cria√ß√£o de servi√ßos SOAP
- **SQLAlchemy**: ORM (Object Relational Mapper) para Python
- **PyJWT**: Implementa√ß√£o do JSON Web Token
- **BCrypt**: Biblioteca para hash de senhas
- **WSGI**: Interface para comunica√ß√£o entre servidor web e aplica√ß√µes Python

### Containeriza√ß√£o
- **Docker**: Plataforma de containeriza√ß√£o
- **Docker Compose**: Orquestrador de containers

## üìÅ Estrutura do Projeto
```
.
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users.db        # Banco de dados SQLite
‚îÇ   ‚îî‚îÄ‚îÄ app.py             # Arquivo principal da aplica√ß√£o
‚îú‚îÄ‚îÄ Dockerfile            # Configura√ß√£o do container da aplica√ß√£o
‚îú‚îÄ‚îÄ docker-compose.yml    # Configura√ß√£o dos servi√ßos
‚îî‚îÄ‚îÄ requirements.txt      # Depend√™ncias do projeto
```


## üíæ Banco de Dados

### Sistema Gerenciador (SGBD)
- SQLite3
- Localiza√ß√£o: `/app/data/users.db`
- Cria√ß√£o autom√°tica na primeira execu√ß√£o

### Estrutura de Tabelas

#### Tabela `users`
| Campo         | Tipo     | Descri√ß√£o               |
| ------------- | -------- | ----------------------- |
| id            | Integer  | Chave prim√°ria          |
| username      | String   | Nome de usu√°rio (√∫nico) |
| first_name    | String   | Primeiro nome           |
| last_name     | String   | Sobrenome               |
| mobile_number | String   | N√∫mero de telefone      |
| email         | String   | Email (√∫nico)           |
| company       | String   | Empresa                 |
| created_at    | DateTime | Data de cria√ß√£o         |
| password      | String   | Senha (hash bcrypt)     |

#### Tabela `groups`
| Campo      | Tipo    | Descri√ß√£o             |
| ---------- | ------- | --------------------- |
| id         | Integer | Chave prim√°ria        |
| group_name | String  | Nome do grupo (√∫nico) |

#### Tabela `user_groups`
| Campo    | Tipo    | Descri√ß√£o                     |
| -------- | ------- | ----------------------------- |
| id_user  | Integer | Chave estrangeira (users.id)  |
| id_group | Integer | Chave estrangeira (groups.id) |

### Usu√°rio Administrador Padr√£o
- Username: `admin`
- Senha: `adm@123`
- Grupo: `SYSTEM`
- Este usu√°rio √© criado automaticamente na primeira execu√ß√£o

## üîê Autentica√ß√£o e Seguran√ßa

### JWT (JSON Web Token)
- Tempo de expira√ß√£o: 120 minutos
- Gerado no login bem-sucedido
- Requerido para todas as opera√ß√µes (exceto autentica√ß√£o)

### Formato do Token
- Header: `Authorization: Bearer <token>`

### Processo de Autentica√ß√£o
1. Cliente envia credenciais (username/password)
2. Sistema valida credenciais
3. Se v√°lido, retorna token JWT
4. Token deve ser inclu√≠do em todas requisi√ß√µes subsequentes

## üöÄ Instala√ß√£o e Execu√ß√£o

### Usando Docker (Recomendado)

1. Clone o reposit√≥rio
```bash
git clone <repository-url>
```

2. Construa e inicie os containers
```bash
docker-compose up -d --build
```

3. Verifique os logs (opcional)
```bash
docker-compose logs -f
```

4. Para parar os containers
```bash
docker-compose down
```

### Instala√ß√£o Manual (Alternativa)

1. Clone o reposit√≥rio
```bash
git clone <repository-url>
```

2. Crie um ambiente virtual
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```

3. Instale as depend√™ncias
```bash
pip install -r requirements.txt
```

4. Execute a aplica√ß√£o
```bash
python app.py
```

O servidor ser√° iniciado em `http://localhost:5000`

## üìù Exemplos de Requisi√ß√µes SOAP

### Autentica√ß√£o (authenticate_user)
```xml
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:user="spyne.examples.userservice">
   <soapenv:Header/>
   <soapenv:Body>
      <user:authenticate_user>
         <user:username>admin</user:username>
         <user:password>adm@123</user:password>
      </user:authenticate_user>
   </soapenv:Body>
</soapenv:Envelope>
```

### Criar Novo Usu√°rio (add_user)
```xml
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:user="spyne.examples.userservice">
   <soapenv:Header>
      <Authorization>Bearer {seu-token-jwt}</Authorization>
   </soapenv:Header>
   <soapenv:Body>
      <user:add_user>
         <user:username>joao.silva</user:username>
         <user:first_name>Jo√£o</user:first_name>
         <user:last_name>Silva</user:last_name>
         <user:mobile_number>11999999999</user:mobile_number>
         <user:email>joao.silva@example.com</user:email>
         <user:company>Empresa XYZ</user:company>
         <user:password>senha123</user:password>
      </user:add_user>
   </soapenv:Body>
</soapenv:Envelope>
```

### Criar Novo Grupo (add_group)
```xml
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:user="spyne.examples.userservice">
   <soapenv:Header>
      <Authorization>Bearer {seu-token-jwt}</Authorization>
   </soapenv:Header>
   <soapenv:Body>
      <user:add_group>
         <user:group_name>Vendas</user:group_name>
      </user:add_group>
   </soapenv:Body>
</soapenv:Envelope>
```

### Adicionar Usu√°rio ao Grupo (add_user_to_group)
```xml
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:user="spyne.examples.userservice">
   <soapenv:Header>
      <Authorization>Bearer {seu-token-jwt}</Authorization>
   </soapenv:Header>
   <soapenv:Body>
      <user:add_user_to_group>
         <user:user_id>2</user:user_id>
         <user:group_id>1</user:group_id>
      </user:add_user_to_group>
   </soapenv:Body>
</soapenv:Envelope>
```

### Listar Usu√°rios (list_users)
```xml
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:user="spyne.examples.userservice">
   <soapenv:Header>
      <Authorization>Bearer {seu-token-jwt}</Authorization>
   </soapenv:Header>
   <soapenv:Body>
      <user:list_users/>
   </soapenv:Body>
</soapenv:Envelope>
```

### Listar Usu√°rios de um Grupo (list_users_in_group)
```xml
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:user="spyne.examples.userservice">
   <soapenv:Header>
      <Authorization>Bearer {seu-token-jwt}</Authorization>
   </soapenv:Header>
   <soapenv:Body>
      <user:list_users_in_group>
         <user:group_id>1</user:group_id>
      </user:list_users_in_group>
   </soapenv:Body>
</soapenv:Envelope>
```

## üìù Notas Importantes

- Todas as senhas s√£o armazenadas com hash BCrypt
- O banco de dados √© criado automaticamente no primeiro uso
- O grupo SYSTEM e usu√°rio admin s√£o criados automaticamente
- Todas as opera√ß√µes (exceto autentica√ß√£o) requerem token JWT v√°lido
- O servidor SOAP est√° dispon√≠vel em `/soap`

## üîí Recomenda√ß√µes de Seguran√ßa

1. Altere a senha do usu√°rio admin ap√≥s a primeira execu√ß√£o
2. Modifique a SECRET_KEY em ambiente de produ√ß√£o
3. Configure HTTPS em ambiente de produ√ß√£o
4. Implemente pol√≠tica de renova√ß√£o de tokens
5. Mantenha as depend√™ncias atualizadas
6. Em ambiente de produ√ß√£o, considere usar um banco de dados mais robusto como PostgreSQL
7. Configure limites de requisi√ß√µes (rate limiting)
8. Implemente monitoramento e logging

## üõ† Testes das Requisi√ß√µes

Para testar as requisi√ß√µes SOAP, voc√™ pode usar:
- SoapUI
- Postman (com raw XML)
- cURL

Exemplo de teste com cURL:
```bash
curl -X POST \
  http://localhost:5000/soap \
  -H 'Content-Type: text/xml' \
  -d '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:user="spyne.examples.userservice">
   <soapenv:Header/>
   <soapenv:Body>
      <user:authenticate_user>
         <user:username>admin</user:username>
         <user:password>adm@123</user:password>
      </user:authenticate_user>
   </soapenv:Body>
</soapenv:Envelope>'
```